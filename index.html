<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Export Treasury Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #F9FAFB;
            --color-text: #1F2937;
            --color-primary: #85583F;
            --color-secondary: #C08A6A;
            --color-accent: #F3EADD;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--color-text);
        }
        .nav-button.active {
            background-color: var(--color-primary);
            color: #FFFFFF;
        }
        .selector-button.active {
            background-color: var(--color-secondary);
            color: #FFFFFF;
            border-color: var(--color-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .accordion-header.open {
            background-color: var(--color-accent);
        }
        .accordion-content {
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.05), 0 1px 2px -1px rgb(0 0 0 / 0.05);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .mobile-nav-scroller::-webkit-scrollbar { display: none; }
        .mobile-nav-scroller { -ms-overflow-style: none; scrollbar-width: none; }
        .timeline-track {
            position: relative;
            width: 100%;
            height: 12px;
            background-color: #E5E7EB;
            border-radius: 6px;
        }
        .timeline-segment {
            position: absolute;
            height: 100%;
            border-radius: 6px;
            background-image: linear-gradient(to right, var(--tw-gradient-stops));
        }
        .timeline-label-container {
            position: relative;
            width: 100%;
            height: 50px;
        }
        .timeline-label {
            position: absolute;
            top: 25px;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .timeline-label::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 8px;
            background-color: #9CA3AF;
        }
         .event-marker {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 2px;
        }
        .formula {
            background-color: #F3F4F6;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            color: #4B5563;
            border: 1px solid #E5E7EB;
        }
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
            width: 100%;
        }
        input[type=range]::-webkit-slider-runnable-track {
            background: var(--color-accent);
            height: 0.5rem;
            border-radius: 0.25rem;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -4px;
            height: 1.25rem;
            width: 1.25rem;
            background-color: var(--color-primary);
            border-radius: 50%;
            border: 2px solid white;
        }
        .calculator-input {
             width: 100%;
             padding: 0.5rem 0.75rem;
             border-radius: 0.375rem;
             border: 1px solid #D1D5DB;
             background-color: #F9FAFB;
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-var(--color-primary)">Export Treasury Simulator</h1>
                </div>
                <div id="desktop-nav" class="hidden lg:flex items-baseline space-x-2"></div>
            </div>
             <div id="mobile-nav" class="lg:hidden pb-2 overflow-x-auto whitespace-nowrap mobile-nav-scroller"></div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">

        <section id="home">
            <div class="text-center">
                <h2 class="text-4xl md:text-5xl font-extrabold text-gray-800 tracking-tight">Mastering Export Finance</h2>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">This interactive simulator is designed to transform complex treasury concepts into practical, actionable knowledge. Move beyond theory and learn by doing.</p>
            </div>
            <div class="card mt-12 p-8">
                <h3 class="text-2xl font-bold text-center text-gray-800 mb-8">Your Learning Journey</h3>
                <div class="flex flex-wrap items-center justify-center gap-x-2 gap-y-4 text-center text-sm font-semibold text-gray-700">
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">1</div>Case Studies</div><div class="text-2xl text-gray-300 font-light">→</div>
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">2</div>Concepts & KPIs</div><div class="text-2xl text-gray-300 font-light">→</div>
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">3</div>Illustrations</div><div class="text-2xl text-gray-300 font-light">→</div>
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">4</div>Portfolio Simulation</div><div class="text-2xl text-gray-300 font-light">→</div>
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">5</div>Forecasting</div><div class="text-2xl text-gray-300 font-light">→</div>
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">6</div>Calculators</div><div class="text-2xl text-gray-300 font-light">→</div>
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">7</div>Currency Risk</div><div class="text-2xl text-gray-300 font-light">→</div>
                    <div class="w-40 text-center"><div class="mx-auto h-16 w-16 rounded-full bg-var(--color-primary) text-white flex items-center justify-center text-2xl font-bold mb-2">8</div>Financing Costs</div>
                </div>
            </div>
        </section>

        <section id="explorer" class="hidden">
            <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Interactive Case Study Explorer</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Analyze real-world export scenarios with detailed cost breakdowns. Select a case study to see the final financial outcome and key profitability drivers.</p></div>
            <div id="case-study-selector" class="flex flex-wrap justify-center gap-2 md:gap-4 mb-10"></div>
            <div class="card p-6 md:p-8 transition-opacity duration-500 ease-in-out" id="case-study-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div><h3 class="text-2xl font-bold text-var(--color-primary) mb-2" id="case-title"></h3><p class="text-gray-600" id="case-description"></p></div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold text-gray-700">Treasury Action</h4><p class="text-gray-600 mt-1" id="case-action"></p></div><div class="bg-gray-50 p-4 rounded-lg"><h4 class="font-semibold text-gray-700">Payment Term</h4><p class="text-gray-600 mt-1" id="case-payment-term"></p></div></div>
                        <div><h4 class="font-semibold text-gray-700 mb-2">Market Data & Assumptions</h4><ul class="space-y-2 text-gray-600" id="case-market-data"></ul></div>
                    </div>
                    <div><h3 class="text-xl font-bold text-center text-gray-800 mb-4">Financial Breakdown</h3><div class="relative w-full h-80 md:h-96"><canvas id="costChart"></canvas></div></div>
                </div>
                <div class="mt-8 overflow-x-auto"><h3 class="text-xl font-bold text-gray-800 mb-4">Profitability Analysis</h3><table class="min-w-full bg-white divide-y divide-gray-200 rounded-lg"><tbody id="case-profitability-table" class="divide-y divide-gray-200"></tbody></table></div>
            </div>
        </section>
        
        <section id="concepts" class="hidden">
            <div class="text-center mb-10">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Concepts & KPIs</h2>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Turn accounting data into strategic intelligence. Understand the core metrics, learn how to calculate them, and measure against export benchmarks to manage your cash flow proactively.</p>
            </div>
            
            <div class="space-y-12">
                <div>
                    <h3 class="text-2xl font-bold text-center text-gray-800 mb-8">The Three Levers of Working Capital</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="card p-6">
                            <h4 class="font-bold text-lg text-gray-800 mb-2">Days Inventory Outstanding (DIO)</h4>
                            <p class="text-sm text-gray-600 italic">"How long is our cash tied up in raw materials and finished goods before shipment?"</p>
                            <div class="mt-4 pt-4 border-t">
                                <p class="font-semibold">Goal: <span class="font-bold text-green-600">LOW</span></p>
                                <p class="mt-2 font-semibold">Export Benchmark: <span class="font-normal text-gray-700">45-75 Days. Longer lead times for export production are common. Higher values may indicate production bottlenecks or slow-moving stock.</span></p>
                            </div>
                        </div>
                        <div class="card p-6">
                            <h4 class="font-bold text-lg text-gray-800 mb-2">Days Sales Outstanding (DSO)</h4>
                            <p class="text-sm text-gray-600 italic">"How quickly are we collecting cash from our foreign customers after shipment?"</p>
                             <div class="mt-4 pt-4 border-t">
                                <p class="font-semibold">Goal: <span class="font-bold text-green-600">LOW</span></p>
                                <p class="mt-2 font-semibold">Export Benchmark: <span class="font-normal text-gray-700">Within 5-10 days of payment terms. E.g., for "90 days from B/L" terms, a DSO of 95-100 is healthy.</span></p>
                            </div>
                        </div>
                        <div class="card p-6">
                            <h4 class="font-bold text-lg text-gray-800 mb-2">Days Payable Outstanding (DPO)</h4>
                            <p class="text-sm text-gray-600 italic">"How effectively are we using our local suppliers' credit to fund operations?"</p>
                             <div class="mt-4 pt-4 border-t">
                                <p class="font-semibold">Goal: <span class="font-bold text-red-600">HIGH</span></p>
                                <p class="mt-2 font-semibold">Export Benchmark: <span class="font-normal text-gray-700">45-60 Days. Optimize cash preservation, but avoid pushing terms too far to maintain good supplier relationships.</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card p-8">
                    <h3 class="text-2xl font-bold text-center text-gray-800 mb-8">How to Calculate Your KPIs Using Zoho Reports</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div>
                            <h4 class="font-semibold text-lg">Calculating DIO</h4>
                            <div class="formula my-2">(Avg. Inventory / COGS) * 365</div>
                            <ol class="list-decimal list-inside text-sm text-gray-600 space-y-1">
                                <li>Run a <strong>Balance Sheet</strong> report for start & end dates to get Inventory values. Calculate the average.</li>
                                <li>Run a <strong>Profit and Loss</strong> report for the period to get Cost of Goods Sold (COGS).</li>
                            </ol>
                        </div>
                         <div>
                            <h4 class="font-semibold text-lg">Calculating DSO</h4>
                            <div class="formula my-2">(Avg. A/R / Credit Sales) * 365</div>
                            <ol class="list-decimal list-inside text-sm text-gray-600 space-y-1">
                                <li>Run a <strong>Balance Sheet</strong> for start & end dates to find Accounts Receivable (A/R). Calculate the average.</li>
                                <li>Run a <strong>Profit and Loss</strong> report for the period to get Total Sales.</li>
                            </ol>
                        </div>
                         <div>
                            <h4 class="font-semibold text-lg">Calculating DPO</h4>
                            <div class="formula my-2">(Avg. A/P / COGS) * 365</div>
                            <ol class="list-decimal list-inside text-sm text-gray-600 space-y-1">
                                <li>Run a <strong>Balance Sheet</strong> for start & end dates to find Accounts Payable (A/P). Calculate the average.</li>
                                <li>Run a <strong>Profit and Loss</strong> report for the period to get Cost of Goods Sold (COGS).</li>
                            </ol>
                        </div>
                    </div>
                </div>

                <div class="card p-8 bg-gray-50">
                     <h3 class="text-2xl font-bold text-center text-gray-800 mb-2">The Master Metric: Cash Conversion Cycle (CCC)</h3>
                     <p class="text-center text-gray-600 mb-6">This formula calculates your funding gap—the exact number of days your own money is stuck in a single transaction.</p>
                     <div class="text-center formula text-2xl font-bold p-4">DIO + DSO - DPO = CCC</div>
                     <p class="text-center mt-4 font-semibold">Export Benchmark: <span class="text-red-600 font-bold">Under 75 Days</span></p>
                     <p class="text-center text-sm text-gray-600 mt-1">A CCC below 75 days is healthy. A CCC below 45 days is excellent and indicates a highly efficient operation.</p>
                </div>
                
                <div class="card p-8">
                    <h3 class="text-2xl font-bold text-center text-gray-800 mb-8">Implementation: From Theory to Live Tracking</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-semibold text-lg mb-2">Step 1: Quantify "The Gap"</h4>
                            <p class="text-sm text-gray-600 mb-2">Calculate the average funding required to sustain operations during your CCC period.</p>
                            <p class="font-semibold">Funding Gap Formula:</p>
                            <div class="formula">(Annual Operating Expenses / 365) * CCC</div>
                        </div>
                         <div>
                            <h4 class="font-semibold text-lg mb-2">Step 2: Bridge The Gap</h4>
                            <p class="text-sm text-gray-600 mb-2">Use short-term credit facilities from your bank, aligned with the export lifecycle.</p>
                            <p class="font-semibold">Common Financing Solutions:</p>
                            <ul class="list-disc list-inside text-sm text-gray-700">
                                <li><strong>Pre-Shipment:</strong> Packing Credit, Bank Overdraft.</li>
                                <li><strong>Post-Shipment:</strong> Bill Discounting, Forfaiting.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 pt-6 border-t">
                        <h4 class="font-semibold text-lg mb-4 text-center">Step 3: Implement Live Tracking in Zoho</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h5 class="font-semibold">A. Build Your Zoho Dashboard</h5>
                                <p class="text-sm text-gray-600 mb-2">Arrange these widgets for an at-a-glance view:</p>
                                <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                                    <li>Total Receivables (for DSO)</li>
                                    <li>Total Payables (for DPO)</li>
                                    <li>Inventory Summary (for DIO)</li>
                                    <li>Cash Flow & Bank Balances</li>
                                </ul>
                            </div>
                             <div>
                                <h5 class="font-semibold">B. Create a KPI Tracking Sheet</h5>
                                <p class="text-sm text-gray-600 mb-2">Use Zoho Sheet or Google Sheets. In a weekly routine:</p>
                                <ol class="list-decimal list-inside text-sm text-gray-700 space-y-1">
                                    <li>Pull key figures from Zoho reports.</li>
                                    <li>Enter them into your KPI sheet.</li>
                                    <li>Analyze the trend chart to track CCC performance.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <section id="illustrations" class="hidden">
            <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Single Order Illustrations</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Now let's apply the formulas. Select a case study to see how its specific terms and timeline components generate the final working capital numbers.</p></div>
            <div id="illustration-selector" class="flex flex-wrap justify-center gap-2 md:gap-4 mb-10"></div>
            <div class="card p-6 md:p-8">
                <h3 class="text-2xl font-bold text-center text-var(--color-primary) mb-8" id="illustration-title"></h3>
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center mb-12">
                    <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400"><p class="text-sm font-semibold text-gray-600">Days Inventory Outstanding (DIO)</p><div class="text-3xl font-bold text-yellow-600" id="ill-dio"></div><p class="text-xs text-gray-500" id="ill-dio-formula"></p></div>
                    <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-400"><p class="text-sm font-semibold text-gray-600">Days Sales Outstanding (DSO)</p><div class="text-3xl font-bold text-blue-600" id="ill-dso"></div><p class="text-xs text-gray-500" id="ill-dso-formula"></p></div>
                    <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400"><p class="text-sm font-semibold text-gray-600">Days Payable Outstanding (DPO)</p><div class="text-3xl font-bold text-green-600" id="ill-dpo"></div><p class="text-xs text-gray-500">From Order to Supplier Payment</p></div>
                </div>
                <div class="mb-12"><h4 class="text-xl font-semibold text-center text-gray-800 mb-2">Anatomy of the Transaction Timeline</h4><p class="text-center text-sm text-gray-500 mb-8">This infographic visualizes every stage, from ordering raw materials to getting paid.</p><div id="illustration-timeline-container" class="w-full space-y-4 text-xs font-medium"></div></div>
                <div class="bg-gray-50 p-6 rounded-lg"><h4 class="text-xl font-bold text-gray-800 mb-4">Calculation & Takeaway</h4><div class="flex flex-col md:flex-row md:items-center justify-center gap-4 text-center mb-4"><p class="text-gray-800 text-lg">CCC Formula:</p><p class="text-xl md:text-2xl font-bold text-gray-800" id="ccc-calculation-string"></p></div><p class="text-gray-700 text-center" id="illustration-narrative"></p></div>
            </div>
        </section>
        
        <section id="simulation" class="hidden">
             <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Dynamic Portfolio Simulation</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Add multiple orders with different timelines to simulate the real-time "stacking effect" on your cash flow and total funding requirement.</p></div>
             
             <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                <div class="xl:col-span-1 space-y-8">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Add New Order/Invoice</h3>
                        <div id="add-order-form" class="space-y-4">
                            <div><label class="text-sm font-semibold">Order Name</label><input type="text" id="sim-order-name" class="calculator-input" placeholder="e.g., PO-123 USA"></div>
                            <div><label class="text-sm font-semibold">Start Date</label><input type="date" id="sim-start-date" class="calculator-input"></div>
                            <div class="grid grid-cols-2 gap-2">
                                <div><label class="text-sm font-semibold">Invoice Value</label><input type="number" id="sim-invoice-value" class="calculator-input" placeholder="e.g., 10000000"></div>
                                <div><label class="text-sm font-semibold">Gross Margin (%)</label><input type="number" id="sim-margin" class="calculator-input" placeholder="e.g., 40"></div>
                            </div>
                            <div class="grid grid-cols-3 gap-2">
                                <div><label class="text-sm font-semibold">DPO</label><input type="number" id="sim-dpo" class="calculator-input" placeholder="Days"></div>
                                <div><label class="text-sm font-semibold">DIO</label><input type="number" id="sim-dio" class="calculator-input" placeholder="Days"></div>
                                <div><label class="text-sm font-semibold">DSO</label><input type="number" id="sim-dso" class="calculator-input" placeholder="Days"></div>
                            </div>
                            <button type="button" id="add-order-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">Add Order to Simulation</button>
                        </div>
                    </div>
                    <div class="card p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Key Treasury Insights</h3>
                        <div class="bg-red-100 p-4 rounded-lg text-center"><p class="text-sm font-semibold text-red-800">Peak Funding Requirement</p><p id="peak-funding" class="text-3xl font-bold text-red-700"></p><p class="text-xs text-red-600">The maximum capital needed at any single point in time.</p></div>
                    </div>
                </div>

                <div class="xl:col-span-2 card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Live Portfolio</h3>
                    <div class="overflow-x-auto mb-8"><table class="min-w-full text-sm text-left"><thead class="bg-gray-50 text-xs text-gray-700 uppercase"><tr><th class="px-4 py-2">Order</th><th class="px-4 py-2">Cash Out</th><th class="px-4 py-2">Cash In</th><th class="px-4 py-2">CCC</th><th class="px-4 py-2">Amount Funded (COGS)</th><th class="px-4 py-2">Action</th></tr></thead><tbody id="simulation-order-table" class="divide-y"></tbody></table></div>
                    
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Simulated Working Capital</h3>
                    <div class="relative w-full h-80 md:h-96"><canvas id="cashFlowChart"></canvas></div>
                </div>
             </div>
        </section>
        
        <section id="forecasting" class="hidden">
            <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Forecasting & Scenario Planning</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Model business scenarios to see the impact on peak funding. Save scenarios to compare different strategies on the chart.</p></div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Scenario Control Panel</h3>
                    <div class="space-y-6">
                        <div><label for="salesGrowth" class="font-semibold">Sales Growth</label><input type="range" id="salesGrowth" min="-50" max="100" value="0" oninput="runForecast()"><span id="salesGrowthValue" class="text-sm text-gray-600 block text-center font-medium"></span></div>
                        <div><label for="avgDIO" class="font-semibold">Average DIO (Days)</label><input type="range" id="avgDIO" min="30" max="120" value="75" oninput="runForecast()"><span id="avgDIOValue" class="text-sm text-gray-600 block text-center font-medium"></span></div>
                        <div><label for="avgDSO" class="font-semibold">Average DSO (Days)</label><input type="range" id="avgDSO" min="30" max="150" value="90" oninput="runForecast()"><span id="avgDSOValue" class="text-sm text-gray-600 block text-center font-medium"></span></div>
                        <div><label for="avgDPO" class="font-semibold">Average DPO (Days)</label><input type="range" id="avgDPO" min="15" max="90" value="45" oninput="runForecast()"><span id="avgDPOValue" class="text-sm text-gray-600 block text-center font-medium"></span></div>
                    </div>
                    <div class="mt-6 pt-6 border-t">
                        <input type="text" id="scenarioName" placeholder="Scenario Name (e.g., High Growth)" class="calculator-input mb-2">
                        <button id="saveScenarioBtn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">Save Scenario</button>
                    </div>
                </div>
                <div class="lg:col-span-2 card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Forecasted Working Capital</h3>
                    <div class="relative w-full h-80 md:h-96"><canvas id="forecastChart"></canvas></div>
                    <div class="mt-6 bg-gray-50 p-6 rounded-lg">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">Saved Scenarios</h4>
                        <div id="scenario-list" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="calculators" class="hidden">
            <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Live Working Capital Calculator</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Input your own company's data to calculate your Cash Conversion Cycle and funding requirements in real-time.</p></div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
                <div class="card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Input Your Financials (Annual)</h3>
                    <div class="space-y-4">
                        <div><label for="calc-sales" class="font-semibold text-sm text-gray-700">Annual Sales Revenue</label><input type="number" id="calc-sales" class="calculator-input" value="10000000" oninput="calculateCustomCCC()"></div>
                        <div><label for="calc-cogs" class="font-semibold text-sm text-gray-700">Annual Cost of Goods Sold (COGS)</label><input type="number" id="calc-cogs" class="calculator-input" value="6000000" oninput="calculateCustomCCC()"></div>
                        <div><label for="calc-inventory" class="font-semibold text-sm text-gray-700">Average Inventory</label><input type="number" id="calc-inventory" class="calculator-input" value="1500000" oninput="calculateCustomCCC()"></div>
                        <div><label for="calc-ar" class="font-semibold text-sm text-gray-700">Average Accounts Receivable (AR)</label><input type="number" id="calc-ar" class="calculator-input" value="2000000" oninput="calculateCustomCCC()"></div>
                        <div><label for="calc-ap" class="font-semibold text-sm text-gray-700">Average Accounts Payable (AP)</label><input type="number" id="calc-ap" class="calculator-input" value="1000000" oninput="calculateCustomCCC()"></div>
                    </div>
                </div>
                <div class="card p-6 bg-gray-50">
                     <h3 class="text-xl font-bold text-center text-gray-800 mb-6">Calculated Results</h3>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-8">
                        <div class="bg-yellow-100 p-4 rounded-lg"><p class="text-sm font-semibold text-yellow-800">DIO</p><div class="text-3xl font-bold text-yellow-700" id="calc-dio-result"></div></div>
                        <div class="bg-blue-100 p-4 rounded-lg"><p class="text-sm font-semibold text-blue-800">DSO</p><div class="text-3xl font-bold text-blue-700" id="calc-dso-result"></div></div>
                        <div class="bg-green-100 p-4 rounded-lg"><p class="text-sm font-semibold text-green-800">DPO</p><div class="text-3xl font-bold text-green-700" id="calc-dpo-result"></div></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-inner">
                        <h4 class="text-lg font-bold text-center text-gray-800 mb-4">Cash Conversion Cycle (CCC)</h4>
                        <div class="flex items-center justify-center gap-2 text-center mb-4"><p class="text-xl font-bold text-gray-800" id="ccc-calc-string"></p></div>
                        <hr class="my-6">
                        <h4 class="text-lg font-bold text-center text-gray-800 mb-4">Working Capital Requirement</h4>
                        <p class="text-4xl text-center font-extrabold text-red-600" id="calc-funding-gap"></p>
                        <p class="text-xs text-gray-500 mt-2 text-center">This is the amount of capital your business needs to fund its operations.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="currencyrisk" class="hidden">
            <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Currency Risk Simulator</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Model the financial outcome of an export invoice based on different hedging strategies and future market movements.</p></div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                <div class="lg:col-span-1 card p-6">
                     <h3 class="text-xl font-bold text-gray-800 mb-6">Transaction Inputs</h3>
                     <div class="space-y-4">
                        <div><label class="font-semibold text-sm">Invoice Amount (FCY)</label><input type="number" id="cr-amount" class="calculator-input" value="100000" oninput="calculateCurrencyRisk()"></div>
                        <div><label class="font-semibold text-sm">Currency</label>
                            <select id="cr-currency" class="calculator-input" onchange="calculateCurrencyRisk()">
                                <option value="USD">USD</option><option value="EUR">EUR</option><option value="GBP">GBP</option>
                            </select>
                        </div>
                        <div><label class="font-semibold text-sm">Current Spot Rate (e.g., USD/INR)</label><input type="number" id="cr-spot" class="calculator-input" value="83.50" oninput="calculateCurrencyRisk()"></div>
                        <div><label class="font-semibold text-sm">Forward Rate Booked (Hedged)</label><input type="number" id="cr-forward" class="calculator-input" value="83.75" oninput="calculateCurrencyRisk()"></div>
                    </div>
                </div>
                <div class="lg:col-span-2 card p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Simulated Outcomes</h3>
                    <div>
                        <label for="cr-future-spot" class="font-semibold">Simulated Spot Rate on Payment Date</label>
                        <input type="range" id="cr-future-spot" min="80" max="86" step="0.01" value="83.50" oninput="calculateCurrencyRisk()">
                        <span id="cr-future-spot-value" class="text-sm text-gray-600 block text-center font-medium"></span>
                    </div>
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg text-center">
                            <h4 class="font-semibold">Hedged Outcome</h4>
                            <p class="text-2xl font-bold text-green-600" id="cr-hedged-result"></p>
                            <p class="text-xs text-gray-500">Guaranteed INR Realization</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg text-center">
                            <h4 class="font-semibold">Unhedged Outcome</h4>
                            <p class="text-2xl font-bold text-blue-600" id="cr-unhedged-result"></p>
                            <p class="text-xs text-gray-500">Based on Simulated Spot Rate</p>
                        </div>
                    </div>
                    <div class="mt-6 bg-blue-50 p-6 rounded-lg text-center">
                        <h4 class="text-lg font-bold text-blue-800">Result of Hedging</h4>
                        <p class="text-3xl font-extrabold" id="cr-final-result"></p>
                    </div>
                </div>
            </div>
        </section>

        <section id="financingcosts" class="hidden">
            <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Financing Cost Calculator</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">Compare the interest costs of different short-term credit facilities to bridge your funding gap.</p></div>
            <div class="card p-8 max-w-6xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                     <div><label class="font-semibold">Funding Gap Amount (INR)</label><input type="number" id="fc-amount" class="calculator-input" value="2500000" oninput="calculateFinancingCosts()"></div>
                     <div><label class="font-semibold">Funding Duration (Days)</label><input type="number" id="fc-duration" class="calculator-input" value="90" oninput="calculateFinancingCosts()"></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h4 class="font-bold text-lg text-center mb-4">Packing Credit (Pre-Shipment)</h4>
                        <label class="font-semibold text-sm">Annual Interest Rate (%)</label>
                        <input type="number" id="fc-pc-rate" class="calculator-input" value="9.5" oninput="calculateFinancingCosts()">
                        <div class="mt-4 pt-4 border-t text-center">
                            <p class="text-sm text-gray-600">Total Interest Cost</p>
                            <p class="text-2xl font-bold text-red-600" id="fc-pc-result"></p>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h4 class="font-bold text-lg text-center mb-4">Bill Discounting (Post-Shipment)</h4>
                        <label class="font-semibold text-sm">Annual Discount Rate (%)</label>
                        <input type="number" id="fc-bd-rate" class="calculator-input" value="8.75" oninput="calculateFinancingCosts()">
                         <div class="mt-4 pt-4 border-t text-center">
                            <p class="text-sm text-gray-600">Total Discount Cost</p>
                            <p class="text-2xl font-bold text-red-600" id="fc-bd-result"></p>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h4 class="font-bold text-lg text-center mb-4">Bank Overdraft / CC</h4>
                        <label class="font-semibold text-sm">Annual Interest Rate (%)</label>
                        <input type="number" id="fc-od-rate" class="calculator-input" value="11.0" oninput="calculateFinancingCosts()">
                         <div class="mt-4 pt-4 border-t text-center">
                            <p class="text-sm text-gray-600">Total Interest Cost</p>
                            <p class="text-2xl font-bold text-red-600" id="fc-od-result"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="zoho" class="hidden">
            <div class="text-center mb-10"><h2 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Zoho Books Implementation Guide</h2><p class="mt-4 max-w-3xl mx-auto text-lg text-gray-600">A practical, step-by-step process for implementing the Unified Export Costing Framework within Zoho Books.</p></div>
            <div class="max-w-4xl mx-auto space-y-4" id="zoho-accordion"></div>
            <div class="card p-6 mt-12 max-w-4xl mx-auto"><h3 class="text-2xl font-semibold text-center text-gray-800 mb-6">Data Integrity: The "Untagged Transactions" Safety Net</h3><p class="text-center text-gray-600 mb-4">This is your most powerful detection tool. Follow these steps to create a custom report that will catch any expense that has not been allocated to a project.</p><ul class="list-decimal list-inside space-y-2 text-gray-700"><li>Navigate to <strong>Reports > Accountant > Export as Data</strong>.</li><li>In the module dropdown, select <strong>Expenses</strong>.</li><li>Click on <strong>+ New Export Template</strong> and create a filter where <strong>Project Name is (empty)</strong>.</li><li>Save the template as "Weekly Untagged Expense Audit". Run it weekly to ensure it's always empty.</li></ul></div>
        </section>

    </main>
    
    <footer class="bg-white mt-12"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center text-gray-500 text-sm"><p>&copy; 2025 Interactive Export Treasury Simulator. All data is illustrative.</p></div></footer>

    <script>
        const navItems = [
            { id: 'home', label: 'Home' }, 
            { id: 'explorer', label: 'Case Studies' }, 
            { id: 'concepts', label: 'Concepts & KPIs' },
            { id: 'illustrations', label: 'Illustrations' }, 
            { id: 'simulation', label: 'Portfolio Simulation' }, 
            { id: 'forecasting', label: 'Forecasting' }, 
            { id: 'calculators', label: 'Calculators' },
            { id: 'currencyrisk', label: 'Currency Risk' },
            { id: 'financingcosts', label: 'Financing Costs' },
            { id: 'zoho', label: 'Zoho Setup' },
        ];
        const caseStudiesData = [
            { title: "Case 1: Baseline USD", description: "This case illustrates the fundamental risk of an unhedged transaction, where profitability is directly exposed to currency market volatility.", currency: "USD", treasuryAction: "Not hedged. Converted at spot rate on receipt.", paymentTerm: "90 days from B/L date", marketData: ["Spot USD/INR on PO Date: 81.60", "Spot USD/INR on Payment Date: 82.15", "Pre-Shipment Finance (90 days @ 9.90%)", "Post-Shipment Finance (90 days @ 9.90%)"], analysis: [ { label: "Invoice Value (FCY)", value: "USD 150,000" }, { label: "Gross Realization in INR", value: "INR 12,322,500", bold: true }, { label: "Less: Total Transaction Costs", value: "", header: true }, { label: "Pre-Shipment Credit Interest", value: "INR 122,055", sub: true }, { label: "Post-Shipment Credit Interest", value: "INR 298,636", sub: true }, { label: "Freight & Insurance (CIF)", value: "INR 750,000", sub: true }, { label: "Banking & Swift Charges", value: "INR 8,500", sub: true }, { label: "Total Transaction Costs", value: "INR 1,179,191", bold: true, sub: true }, { label: "Net Realization in INR", value: "INR 11,143,309", bold: true }, { label: "Forex Gain / Loss", value: "INR 82,500 (Gain)", highlight: 'green' } ], chartData: { costs: [122055, 298636, 750000, 8500], costLabels: ["Pre-Ship Interest", "Post-Ship Interest", "Freight & Insurance", "Bank Charges"], net: 11143309 }, illustration: { invoiceValue: 12322500, dpo: 45, rawMaterialDays: 30, productionDays: 60, shippingTransitDays: 20, customerCreditDays: 70, cogs: 9241875, apValue: 5545125 } },
            { title: "Case 2: Hedged EUR", description: "Demonstrates how a forward contract eliminates uncertainty and locks in a guaranteed profit margin, avoiding a potential loss.", currency: "EUR", treasuryAction: "Booked a 3-month forward contract to sell EUR 200,000.", paymentTerm: "90 days from B/L date", marketData: ["Spot EUR/INR on PO Date: 89.65", "3-Month Forward Rate Booked: 90.10", "Spot EUR/INR on Payment Date: 89.20"], analysis: [ { label: "Invoice Value (FCY)", value: "EUR 200,000" }, { label: "Gross Realization in INR (Locked-in)", value: "INR 18,020,000", bold: true }, { label: "Less: Total Transaction Costs", value: "", header: true }, { label: "Pre-Shipment Credit Interest", value: "INR 197,260", sub: true }, { label: "Post-Shipment Credit Interest", value: "INR 440,008", sub: true }, { label: "Banking & Forward Booking Charges", value: "INR 11,000", sub: true }, { label: "Total Transaction Costs", value: "INR 648,268", bold: true, sub: true }, { label: "Net Realization in INR", value: "INR 17,371,732", bold: true }, { label: "Forex Loss Avoided by Hedging", value: "INR 180,000", highlight: 'green' } ], chartData: { costs: [197260, 440008, 11000], costLabels: ["Pre-Ship Interest", "Post-Ship Interest", "Bank & Fwd Charges"], net: 17371732 }, illustration: { invoiceValue: 18020000, dpo: 45, rawMaterialDays: 30, productionDays: 60, shippingTransitDays: 20, customerCreditDays: 70, cogs: 13515000, apValue: 8109000 } },
            { title: "Case 3: Cost of Delay GBP", description: "Highlights how operational failures in the supply chain can lead to significant, unbudgeted financial penalties that erode profitability.", currency: "GBP", treasuryAction: "Hedged with a 2-month forward contract.", paymentTerm: "60 days from B/L date", marketData: ["Spot GBP/INR on PO Date: 106.50", "2-Month Forward Rate Booked: 107.05", "Demurrage: 5 days @ GBP 150/day", "Detention: 3 days @ GBP 100/day"], analysis: [ { label: "Invoice Value (FCY)", value: "GBP 100,000" }, { label: "Gross Realization in INR (Locked-in)", value: "INR 10,705,000", bold: true }, { label: "Less: Total Transaction Costs", value: "", header: true }, { label: "Pre-Shipment Credit Interest", value: "INR 78,904", sub: true }, { label: "Post-Shipment Credit Interest", value: "INR 174,013", sub: true }, { label: "Freight, Duties & Transport (DDP)", value: "INR 1,200,000", sub: true }, { label: "Banking & Swift Charges", value: "INR 8,500", sub: true }, { label: "Contingent Costs", value: "INR 112,140", sub: true, highlight: 'red' }, { label: "Total Transaction Costs", value: "INR 1,573,557", bold: true, sub: true }, { label: "Net Realization in INR", value: "INR 9,131,443", bold: true }, ], chartData: { costs: [78904, 174013, 1200000, 8500, 112140], costLabels: ["Pre-Ship Interest", "Post-Ship Interest", "Logistics", "Bank Charges", "Demurrage"], net: 9131443 }, illustration: { invoiceValue: 10705000, dpo: 45, rawMaterialDays: 20, productionDays: 40, shippingTransitDays: 15, customerCreditDays: 45, cogs: 8028750, apValue: 4817250 } },
            { title: "Case 4: Volatility JPY", description: "Compares the outcomes for a shipment in a volatile currency, quantifying the value and opportunity cost of hedging.", currency: "JPY", treasuryAction: "Analyzed both Unhedged and Hedged scenarios.", paymentTerm: "90 days from B/L date", marketData: ["Spot JPY/INR (per 100) on PO Date: 55.80", "3-Month Forward Rate: 56.10", "Spot JPY/INR (per 100) on Payment Date: 57.50"], analysis: [ { label: "Gross Realization (Unhedged)", value: "INR 14,375,000", bold: true }, { label: "Gross Realization (Hedged)", value: "INR 14,025,000", bold: true }, { label: "Net Realization (Unhedged)", value: "INR 12,367,292", bold: true }, { label: "Net Realization (Hedged)", value: "INR 12,023,458", bold: true }, { label: "Forex Gain (Unhedged)", value: "INR 425,000 (Gain)", highlight: 'green' }, { label: "Opportunity Cost of Hedging", value: "INR 343,834", highlight: 'orange' } ], chartData: { type: 'grouped', unhedged: { net: 12367292, costs: 2007708 }, hedged: { net: 12023458, costs: 2001542 } }, illustration: { invoiceValue: 14025000, dpo: 45, rawMaterialDays: 30, productionDays: 60, shippingTransitDays: 20, customerCreditDays: 70, cogs: 10781250, apValue: 6468750 } },
            { title: "Case 5: Long Credit AUD", description: "Examines the direct cost of offering extended credit terms and the significant impact of post-shipment financing choices.", currency: "AUD", treasuryAction: "Hedged with a 4-month forward contract.", paymentTerm: "120 days from B/L date", marketData: ["Spot AUD/INR on PO Date: 55.20", "4-Month Forward Rate Booked: 55.65", "Post-Shipment Finance (120 days @ 9.90%)"], analysis: [ { label: "Invoice Value (FCY)", value: "AUD 250,000" }, { label: "Gross Realization in INR (Locked-in)", value: "INR 13,912,500", bold: true }, { label: "Less: Total Transaction Costs", value: "", header: true }, { label: "Pre-Shipment Credit Interest", value: "INR 157,808", sub: true }, { label: "Post-Shipment Credit Interest (120 days)", value: "INR 452,518", sub: true, highlight: 'red' }, { label: "Banking & Swift Charges", value: "INR 8,500", sub: true }, { label: "Total Transaction Costs", value: "INR 618,826", bold: true, sub: true }, { label: "Net Realization in INR", value: "INR 13,293,674", bold: true } ], chartData: { costs: [157808, 452518, 8500], costLabels: ["Pre-Ship Interest", "Post-Ship Interest (120d)", "Bank Charges"], net: 13293674 }, illustration: { invoiceValue: 13912500, dpo: 45, rawMaterialDays: 30, productionDays: 60, shippingTransitDays: 30, customerCreditDays: 90, cogs: 10434375, apValue: 6260625 } }
        ];
        const zohoGuideData = [
            { title: "1. Foundational Setup", content: `<p class="mb-4">Before tracking orders, configure your Zoho Books account for export operations.</p><ul class="list-disc pl-5 space-y-2"><li><strong>Customize Chart of Accounts:</strong> Create specific expense accounts (e.g., 'Export: Pre-Shipment Interest', 'Export: Bill Discounting Charges') for accurate tracking.</li><li><strong>Enable Multi-Currency:</strong> Add all foreign currencies you transact in.</li><li><strong>Set Up Items:</strong> Define raw materials and finished goods to track inventory for accurate COGS calculation.</li></ul>` }, { title: "2. Tracking an Export Order as a Project", content: `<p class="mb-4">This is the core of the PO-centric costing method. Each export PO becomes a distinct profit center.</p><ul class="list-disc pl-5 space-y-2"><li><strong>Enable Projects Module:</strong> Ensure the 'Timesheet' module is enabled in settings.</li><li><strong>Create a Project for Each PO:</strong> When a new export PO is received, create a new project. Use the PO number as the project name (e.g., "PO-123-USA").</li></ul>` }, { title: "3. Recording Costs & Revenue", content: `<p class="mb-4">Meticulously link every single transaction to its corresponding project.</p><ul class="list-disc pl-5 space-y-2"><li><strong>Record Expenses:</strong> For all costs (interest, bank charges, freight), you must select the customer and associate it with the correct <strong>Project</strong>.</li><li><strong>Create Export Invoice:</strong> When creating the sales invoice, link it to the same project.</li></ul>` }, { title: "4. Analyzing Profitability", content: `<p class="mb-4">With all data tracked, you can now view the true profitability of each export order.</p><ul class="list-disc pl-5 space-y-2"><li><strong>Run the Project Profitability Report:</strong> Navigate to 'Reports' > 'Projects' > 'Profit and Loss for Projects'.</li><li><strong>Filter by Project:</strong> Select the specific project to generate its P&L statement, showing true net profit.</li></ul>` }
        ];
        let costChart, cashFlowChart, forecastChart;
        let savedScenarios = [];
        let userPortfolio = [];

        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation(); setupSelectors(); setupZohoAccordion(); initCharts();
            displayCaseStudy(0); displayIllustration(0);
            
            document.getElementById('add-order-btn').addEventListener('click', addOrderToPortfolio);
            initializeDynamicSimulation();
            
            updateSliderDisplay(); 
            runForecast(); 
            
            calculateCustomCCC(); calculateCurrencyRisk(); calculateFinancingCosts();
            showSection('home');
            
            document.getElementById('saveScenarioBtn').addEventListener('click', saveScenario);
        });
        
        // --- All setup, display, and chart functions ---
        
        function setupNavigation() {
            const desktopNav = document.getElementById('desktop-nav'); const mobileNav = document.getElementById('mobile-nav');
            navItems.forEach(item => {
                const dButton = document.createElement('button'); dButton.id = `nav-d-${item.id}`; dButton.className = 'nav-button px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-var(--color-accent)'; dButton.textContent = item.label; dButton.onclick = () => showSection(item.id); desktopNav.appendChild(dButton);
                const mButton = document.createElement('button'); mButton.id = `nav-m-${item.id}`; mButton.className = 'nav-button px-4 py-2 rounded-full text-sm font-semibold mr-2 flex-shrink-0'; mButton.textContent = item.label; mButton.onclick = () => showSection(item.id); mobileNav.appendChild(mButton);
            });
        }
        
        function setupSelectors() {
            const csSelector = document.getElementById('case-study-selector'); const illSelector = document.getElementById('illustration-selector');
            csSelector.innerHTML = ''; illSelector.innerHTML = '';
            caseStudiesData.forEach((study, index) => {
                const csButton = document.createElement('button'); csButton.className = 'selector-button px-4 py-2 text-sm md:text-base font-semibold border-2 border-gray-300 rounded-full shadow-sm hover:bg-var(--color-accent) transition-all duration-300 ease-in-out'; csButton.textContent = study.title; csButton.onclick = () => displayCaseStudy(index); csSelector.appendChild(csButton);
                const illButton = csButton.cloneNode(true); illButton.onclick = () => displayIllustration(index); illSelector.appendChild(illButton);
            });
        }

        function setupZohoAccordion() {
            const accordionContainer = document.getElementById('zoho-accordion');
            if(!accordionContainer) return;
            accordionContainer.innerHTML = '';
            zohoGuideData.forEach((item) => {
                const div = document.createElement('div'); div.className = 'card overflow-hidden';
                div.innerHTML = `<button class="accordion-header w-full text-left p-4 font-semibold text-gray-800 flex justify-between items-center hover:bg-var(--color-accent)"><span>${item.title}</span><span class="transform transition-transform duration-300 text-var(--color-primary) text-xl">&#x25BC;</span></button><div class="accordion-content"><div class="p-4 bg-gray-50 text-gray-600 border-t">${item.content}</div></div>`;
                accordionContainer.appendChild(div);
            });
            accordionContainer.addEventListener('click', (event) => {
                const header = event.target.closest('.accordion-header'); if (!header) return; const content = header.nextElementSibling; const isOpen = content.style.maxHeight && content.style.maxHeight !== '0px';
                document.querySelectorAll('.accordion-content').forEach(c => { c.style.maxHeight = '0px'; c.previousElementSibling.classList.remove('open'); c.previousElementSibling.querySelector('span:last-child').style.transform = 'rotate(0deg)'; });
                if (!isOpen) { content.style.maxHeight = content.scrollHeight + 'px'; header.classList.add('open'); header.querySelector('span:last-child').style.transform = 'rotate(180deg)';}
            });
        }

        function displayCaseStudy(index) {
            const study = caseStudiesData[index];
            document.getElementById('case-title').textContent = study.title; document.getElementById('case-description').textContent = study.description; document.getElementById('case-action').textContent = study.treasuryAction; document.getElementById('case-payment-term').textContent = study.paymentTerm;
            document.getElementById('case-market-data').innerHTML = study.marketData.map(item => `<li class="flex items-center"><span class="text-var(--color-secondary) mr-2">&#x25CF;</span>${item}</li>`).join('');
            document.getElementById('case-profitability-table').innerHTML = study.analysis.map(row => {
                if (row.header) return `<tr class="bg-gray-100"><td colspan="2" class="px-6 py-2 text-sm font-bold text-gray-700">${row.label}</td></tr>`;
                let valueClass = 'text-gray-800'; if (row.highlight === 'green') valueClass = 'text-green-600 font-semibold'; if (row.highlight === 'red') valueClass = 'text-red-600 font-semibold'; if (row.highlight === 'orange') valueClass = 'text-orange-500 font-semibold';
                return `<tr class="${row.bold && !row.sub ? 'bg-gray-50' : ''}"><td class="px-6 py-3 text-sm font-medium text-gray-600 ${row.sub ? 'pl-10' : ''}">${row.label}</td><td class="px-6 py-3 text-sm text-right ${valueClass} ${row.bold ? 'font-bold' : ''}">${row.value}</td></tr>`;
            }).join('');
            updateChart(costChart, study.chartData);
            document.querySelectorAll('#case-study-selector button').forEach((btn, i) => btn.classList.toggle('active', i === index));
        }
        
        function displayIllustration(index) {
            const study = caseStudiesData[index]; const ill = study.illustration;
            const dio = ill.rawMaterialDays + ill.productionDays; const dso = ill.shippingTransitDays + ill.customerCreditDays; const dpo = ill.dpo; const ccc = dio + dso - dpo;
            const formatCurrency = (num) => `₹${(num / 100000).toFixed(1)}L`;
            document.getElementById('illustration-title').textContent = study.title;
            document.getElementById('ill-dio').textContent = `${dio} Days`; document.getElementById('ill-dso').textContent = `${dso} Days`; document.getElementById('ill-dpo').textContent = `${dpo} Days`;
            document.getElementById('ill-dio-formula').textContent = `Raw Material (${ill.rawMaterialDays}d) + Production (${ill.productionDays}d)`;
            document.getElementById('ill-dso-formula').textContent = `Transit (${ill.shippingTransitDays}d) + Credit (${ill.customerCreditDays}d)`;
            document.getElementById('ccc-calculation-string').innerHTML = `<span class="text-yellow-600">${dio}</span><span class="text-sm">(DIO)</span> + <span class="text-blue-600">${dso}</span><span class="text-sm">(DSO)</span> - <span class="text-green-600">${dpo}</span><span class="text-sm">(DPO)</span> = <span class="text-5xl font-extrabold text-red-600 ml-2">${ccc}</span><span class="text-lg text-red-600 font-semibold ml-1">Days</span>`;
            document.getElementById('illustration-narrative').textContent = `For this transaction, a funding gap of ${formatCurrency(ill.cogs)} exists for a total of ${ccc} days. This period begins the moment you pay your supplier (Cash Out) and only ends when your customer pays (Cash In). This ${ccc}-day gap must be financed through your own capital or banking facilities.`;
            document.querySelectorAll('#illustration-selector button').forEach((btn, i) => btn.classList.toggle('active', i === index));
            drawDetailedTimeline(ill);
        }

        function drawDetailedTimeline(data) {
           const container = document.getElementById('illustration-timeline-container'); container.innerHTML = '';
            const dio = data.rawMaterialDays + data.productionDays; const dso = data.shippingTransitDays + data.customerCreditDays; const dpo = data.dpo; const totalCycleDays = dio + dso;
            if(totalCycleDays <= 0) return;
            const timelineData = [
                { name: 'Operational Flow', segments: [ { label: `Raw Material (${data.rawMaterialDays}d)`, duration: data.rawMaterialDays, color: 'from-yellow-300 to-yellow-400' }, { label: `Production (${data.productionDays}d)`, duration: data.productionDays, color: 'from-yellow-400 to-yellow-500' }, { label: `Transit (${data.shippingTransitDays}d)`, duration: data.shippingTransitDays, color: 'from-blue-300 to-blue-400' }, { label: `Credit (${data.customerCreditDays}d)`, duration: data.customerCreditDays, color: 'from-blue-400 to-blue-500' }, ]},
                { name: 'Financial Flow (AP/AR)', segments: [ { label: `Accounts Payable (DPO: ${dpo}d)`, duration: dpo, color: 'from-green-300 to-green-500' }, { label: `Accounts Receivable (DSO: ${dso}d)`, duration: dso, offset: dio, color: 'from-blue-300 to-blue-500' }, ]},
                { name: 'Cash Flow (Funding Gap)', segments: [ { label: `Supplier Credit`, duration: dpo, color: 'from-green-300 to-green-500' }, { label: `FUNDING GAP (CCC: ${dio + dso - dpo}d)`, duration: dio + dso - dpo, offset: dpo, color: 'from-red-400 to-red-600' }, ]},
            ];
            timelineData.forEach(layer => {
                let html = `<div class="mb-1"><p class="font-bold text-gray-700 text-sm">${layer.name}</p></div><div class="timeline-label-container">`; let trackHtml = `<div class="timeline-track">`; let cumulativeOffset = 0;
                layer.segments.forEach(seg => {
                    const width = (seg.duration / totalCycleDays) * 100; const offset = ((seg.offset !== undefined ? seg.offset : cumulativeOffset) / totalCycleDays) * 100; const midpoint = offset + width / 2;
                    trackHtml += `<div class="timeline-segment bg-gradient-to-r ${seg.color}" style="left: ${offset}%; width: ${width}%;"></div>`;
                    html += `<div class="timeline-label text-gray-600" style="left: ${midpoint}%;">${seg.label}</div>`;
                    if (seg.offset === undefined) cumulativeOffset += seg.duration;
                });
                trackHtml += `</div>`; html += `</div>${trackHtml}`;
                if (layer.name === 'Cash Flow (Funding Gap)') {
                    const cashOutPercent = (dpo / totalCycleDays) * 100;
                    html += `<div class="relative w-full h-10 text-gray-600"><div class="timeline-track" style="background:transparent;"><div class="event-marker bg-red-600 shadow-red-500/50" style="left: ${cashOutPercent}%;"></div><div class="event-marker bg-green-600 shadow-green-500/50" style="left: 100%;"></div><div class="absolute text-center text-xs" style="left: ${cashOutPercent}%; top:20px; transform: translateX(-50%);"><span class="font-semibold">Cash Out</span><br>(Pay Supplier)</div><div class="absolute text-center text-xs" style="left: 100%; top:20px; transform: translateX(-50%);"><span class="font-semibold">Cash In</span><br>(Paid by Customer)</div></div></div>`;
                }
                container.innerHTML += `<div class="mb-8">${html}</div>`;
            });
        }

        function initCharts() {
            const costCtx = document.getElementById('costChart').getContext('2d');
            costChart = new Chart(costCtx, { type: 'bar', data: { labels: [], datasets: [] }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } }, plugins: { tooltip: { callbacks: { label: c => `${c.dataset.label || ''}: ${new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(c.parsed.y)}` } } } } });
            
            const cashFlowCtx = document.getElementById('cashFlowChart').getContext('2d');
            cashFlowChart = new Chart(cashFlowCtx, { type: 'line', data: { datasets: []}, options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'month' }, grid: { display: false } }, y: { beginAtZero: true, ticks: { callback: (v) => `₹${(v/100000).toFixed(0)}L` } } }, interaction: { mode: 'index', intersect: false }, plugins: { tooltip: { callbacks: { label: c => `Required Capital: ${new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(c.parsed.y)}` } }, legend: {display: false} } } });

            const forecastCtx = document.getElementById('forecastChart').getContext('2d');
            forecastChart = new Chart(forecastCtx, { type: 'line', data: { datasets: []}, options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'month' }, grid: { display: false } }, y: { beginAtZero: true, ticks: { callback: (v) => `₹${(v/100000).toFixed(0)}L` } } }, 
            interaction: {
                mode: 'index',
                intersect: false 
            }, 
            plugins: { tooltip: { callbacks: { label: c => `${c.dataset.label}: ${new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(c.parsed.y)}` } }, annotation: { annotations: {} } } } });
        }

        function updateChart(chart, data) {
           const isGrouped = data.type === 'grouped'; chart.options.scales.x.stacked = !isGrouped; chart.options.scales.y.stacked = !isGrouped;
            if (isGrouped) {
                chart.data.labels = ['Unhedged', 'Hedged']; chart.data.datasets = [ { label: 'Net Realization', data: [data.unhedged.net, data.hedged.net], backgroundColor: '#85583F' }, { label: 'Total Costs', data: [data.unhedged.costs, data.hedged.costs], backgroundColor: '#F3EADD' } ];
            } else {
                chart.data.labels = ['Financial Breakdown']; const costColors = ['#FAD2B1', '#F2B880', '#E99A4D', '#C08A6A', '#BF8B67'];
                const datasets = [{ label: 'Net Realization', data: [data.net], backgroundColor: '#85583F' }];
                data.costs.forEach((cost, i) => datasets.push({ label: data.costLabels[i], data: [cost], backgroundColor: costColors[i % costColors.length] }));
                chart.data.datasets = datasets;
            }
            chart.update();
        }

        // --- Dynamic Portfolio Simulation Functions ---
        function initializeDynamicSimulation() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('sim-start-date').value = todayStr;
            
            const startDates = [
                new Date('2025-10-01'), new Date('2025-10-10'), new Date('2025-10-22'), new Date('2025-11-05'), new Date('2025-11-15')
            ];

            userPortfolio = caseStudiesData.map((study, index) => {
                const ill = study.illustration;
                const margin = ill.invoiceValue > 0 ? ((ill.invoiceValue - ill.cogs) / ill.invoiceValue) * 100 : 25;
                return {
                    name: study.title,
                    startDate: startDates[index],
                    invoiceValue: ill.invoiceValue,
                    margin: isFinite(margin) ? margin : 25,
                    cogs: ill.cogs,
                    dpo: ill.dpo,
                    dio: ill.rawMaterialDays + ill.productionDays,
                    dso: ill.shippingTransitDays + ill.customerCreditDays
                };
            });
            renderDynamicSimulation();
        }

        function addOrderToPortfolio() {
            const name = document.getElementById('sim-order-name').value || `Order ${userPortfolio.length + 1}`;
            const startDate = new Date(document.getElementById('sim-start-date').value);
            const invoiceValue = parseFloat(document.getElementById('sim-invoice-value').value);
            const margin = parseFloat(document.getElementById('sim-margin').value);
            const dpo = parseInt(document.getElementById('sim-dpo').value);
            const dio = parseInt(document.getElementById('sim-dio').value);
            const dso = parseInt(document.getElementById('sim-dso').value);

            if (isNaN(invoiceValue) || isNaN(margin) || isNaN(dpo) || isNaN(dio) || isNaN(dso) || !startDate.getTime()) {
                alert('Please fill in all fields with valid data.');
                return;
            }

            const cogs = invoiceValue * (1 - (margin / 100));

            userPortfolio.push({ name, startDate, invoiceValue, margin, cogs, dpo, dio, dso });
            userPortfolio.sort((a,b) => new Date(a.startDate) - new Date(b.startDate));
            renderDynamicSimulation();
            
            const form = document.getElementById('add-order-form');
            if (form) form.reset();

            const todayStr = new Date().toISOString().split('T')[0];
            document.getElementById('sim-start-date').value = todayStr;
        }

        function renderDynamicSimulation() {
            const tableBody = document.getElementById('simulation-order-table');
            tableBody.innerHTML = '';
            const formatDate = (date) => date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
            const formatCurrency = (num) => new Intl.NumberFormat('en-IN', {style: 'currency', currency: 'INR', maximumFractionDigits: 0}).format(num);
            const addDays = (date, days) => { const result = new Date(date); result.setDate(result.getDate() + days); return result; };

            if (userPortfolio.length === 0) {
                cashFlowChart.data.datasets = [];
                cashFlowChart.update();
                document.getElementById('peak-funding').textContent = formatCurrency(0);
                runForecast();
                return;
            }

            userPortfolio.forEach((order, index) => {
                const cashOutDate = addDays(new Date(order.startDate), order.dpo);
                const cashInDate = addDays(new Date(order.startDate), order.dpo + order.dio + order.dso);
                const ccc = order.dio + order.dso - order.dpo;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-3 font-medium text-gray-900">${order.name}</td>
                    <td class="px-4 py-3">${formatDate(cashOutDate)}</td>
                    <td class="px-4 py-3">${formatDate(cashInDate)}</td>
                    <td class="px-4 py-3 font-semibold">${ccc} days</td>
                    <td class="px-4 py-3 font-semibold text-red-600">${formatCurrency(order.cogs)}</td>
                    <td class="px-4 py-3"><button data-index="${index}" class="remove-order-btn text-red-500 hover:text-red-700 font-bold">Remove</button></td>
                `;
                tableBody.appendChild(row);
            });
            
            document.querySelectorAll('.remove-order-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    userPortfolio.splice(e.target.dataset.index, 1);
                    renderDynamicSimulation();
                });
            });

            const { cashFlowData, peakFunding } = calculateCashFlow(userPortfolio);
            
            document.getElementById('peak-funding').textContent = formatCurrency(peakFunding);
            cashFlowChart.data.datasets = [{ data: cashFlowData, borderColor: '#DC2626', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.1, pointRadius: 0, pointHoverRadius: 5 }];
            cashFlowChart.update();
            runForecast(); 
        }
        
        function calculateCashFlow(portfolio) {
            if (portfolio.length === 0) return { cashFlowData: [], peakFunding: 0 };
            
            const addDays = (date, days) => { const result = new Date(date); result.setDate(result.getDate() + days); return result; };
            const cashFlowEvents = [];
            portfolio.forEach(order => {
                const startDate = new Date(order.startDate);
                cashFlowEvents.push({ date: addDays(startDate, order.dpo), amount: -order.cogs });
                cashFlowEvents.push({ date: addDays(startDate, order.dpo + order.dio + order.dso), amount: order.invoiceValue });
            });
            cashFlowEvents.sort((a, b) => a.date - b.date);

            let cumulative = 0; let peakFunding = 0;
            const simStartDate = new Date(portfolio[0].startDate);
            const cashFlowData = [{x: simStartDate, y: 0}];
            let lastDate = simStartDate;

            cashFlowEvents.forEach(event => {
                if (event.date > lastDate) {
                     cashFlowData.push({ x: new Date(event.date.getTime() - 1), y: -Math.min(0, cumulative) });
                }
                cumulative += event.amount;
                cashFlowData.push({ x: event.date, y: -Math.min(0, cumulative) });
                if (-cumulative > peakFunding) peakFunding = -cumulative;
                lastDate = event.date;
            });

            if (cashFlowEvents.length > 0) {
                 const finalDate = cashFlowEvents[cashFlowEvents.length - 1].date;
                 cashFlowData.push({x: addDays(finalDate, 30), y: cashFlowData[cashFlowData.length-1].y});
            }
            
            return { cashFlowData, peakFunding };
        }
        
        function updateSliderDisplay() {
            const salesGrowth = document.getElementById('salesGrowth').value;
            document.getElementById('salesGrowthValue').textContent = `${salesGrowth > 0 ? '+' : ''}${salesGrowth}%`;
            document.getElementById('avgDIOValue').textContent = `${document.getElementById('avgDIO').value} Days`;
            document.getElementById('avgDSOValue').textContent = `${document.getElementById('avgDSO').value} Days`;
            document.getElementById('avgDPOValue').textContent = `${document.getElementById('avgDPO').value} Days`;
        }

        function runForecast() {
            updateSliderDisplay();
            
            if (userPortfolio.length === 0) {
                forecastChart.data.datasets = [];
                forecastChart.update();
                return;
            }
            
            const salesGrowth = parseInt(document.getElementById('salesGrowth').value);
            const avgDIO = parseInt(document.getElementById('avgDIO').value);
            const avgDSO = parseInt(document.getElementById('avgDSO').value);
            const avgDPO = parseInt(document.getElementById('avgDPO').value);
            
            const basePortfolio = JSON.parse(JSON.stringify(userPortfolio));
            const forecastPortfolio = JSON.parse(JSON.stringify(userPortfolio));
            const growthMultiplier = 1 + (salesGrowth / 100);

            forecastPortfolio.forEach(order => {
                order.invoiceValue *= growthMultiplier;
                order.cogs *= growthMultiplier;
                order.dio = avgDIO;
                order.dso = avgDSO;
                order.dpo = avgDPO;
            });
            
            const { cashFlowData: baseCashFlow } = calculateCashFlow(basePortfolio);
            const { cashFlowData: forecastCashFlow } = calculateCashFlow(forecastPortfolio);
            
            let datasets = [
                { label: 'Baseline', data: baseCashFlow, borderColor: '#9CA3AF', tension: 0.1, pointRadius: 0, borderDash: [5, 5] },
                { label: 'Current Forecast', data: forecastCashFlow, borderColor: '#3B82F6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.1, pointRadius: 0 }
            ];

            const colors = ['#16A34A', '#D97706', '#9333EA', '#ca8a04', '#0891b2'];
            savedScenarios.forEach((scenario, index) => {
                if(scenario.active) {
                    datasets.push({
                        label: scenario.name,
                        data: scenario.data,
                        borderColor: colors[index % colors.length],
                        tension: 0.1,
                        pointRadius: 0,
                    });
                }
            });

            forecastChart.data.datasets = datasets;
            forecastChart.update();
        }

        function saveScenario() {
            if (userPortfolio.length === 0) {
                alert("Please add orders to the Portfolio Simulation first.");
                return;
            }

            const nameInput = document.getElementById('scenarioName');
            let name = nameInput.value.trim();
            if (!name) {
                name = `Scenario ${savedScenarios.length + 1}`;
            }
            
            const salesGrowth = parseInt(document.getElementById('salesGrowth').value);
            const avgDIO = parseInt(document.getElementById('avgDIO').value);
            const avgDSO = parseInt(document.getElementById('avgDSO').value);
            const avgDPO = parseInt(document.getElementById('avgDPO').value);

            const forecastPortfolio = JSON.parse(JSON.stringify(userPortfolio));
            const growthMultiplier = 1 + (salesGrowth / 100);

            forecastPortfolio.forEach(order => {
                order.invoiceValue *= growthMultiplier;
                order.cogs *= growthMultiplier;
                order.dio = avgDIO;
                order.dso = avgDSO;
                order.dpo = avgDPO;
            });
            
            const { cashFlowData } = calculateCashFlow(forecastPortfolio);

            savedScenarios.push({
                name: name,
                params: { salesGrowth, avgDIO, avgDSO, avgDPO },
                data: cashFlowData,
                active: true
            });
            
            nameInput.value = '';
            updateScenarioList();
            runForecast();
        }

        function updateScenarioList() {
            const listEl = document.getElementById('scenario-list');
            listEl.innerHTML = '';
            savedScenarios.forEach((scenario, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex items-center justify-between bg-white p-2 rounded-md';
                itemEl.innerHTML = `
                    <div class="flex items-center">
                        <input type="checkbox" id="scenario-toggle-${index}" class="mr-2 h-4 w-4" ${scenario.active ? 'checked' : ''}>
                        <div>
                            <label for="scenario-toggle-${index}" class="font-semibold text-sm">${scenario.name}</label>
                            <p class="text-xs text-gray-500">SG: ${scenario.params.salesGrowth}%, DIO: ${scenario.params.avgDIO}, DSO: ${scenario.params.avgDSO}, DPO: ${scenario.params.avgDPO}</p>
                        </div>
                    </div>
                    <button data-index="${index}" class="remove-scenario-btn text-red-500 hover:text-red-700 font-bold text-sm">Remove</button>
                `;
                listEl.appendChild(itemEl);
            });

            listEl.querySelectorAll('input[type="checkbox"]').forEach((checkbox, index) => {
                checkbox.addEventListener('change', () => {
                    savedScenarios[index].active = checkbox.checked;
                    runForecast();
                });
            });

            listEl.querySelectorAll('.remove-scenario-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const index = parseInt(button.dataset.index);
                    savedScenarios.splice(index, 1);
                    updateScenarioList();
                    runForecast();
                });
            });
        }
        
        function calculateCustomCCC() {
            const sales = parseFloat(document.getElementById('calc-sales').value) || 0;
            const cogs = parseFloat(document.getElementById('calc-cogs').value) || 0;
            const inventory = parseFloat(document.getElementById('calc-inventory').value) || 0;
            const ar = parseFloat(document.getElementById('calc-ar').value) || 0;
            const ap = parseFloat(document.getElementById('calc-ap').value) || 0;

            const dio = cogs > 0 ? (inventory / cogs) * 365 : 0;
            const dso = sales > 0 ? (ar / sales) * 365 : 0;
            const dpo = cogs > 0 ? (ap / cogs) * 365 : 0;
            const ccc = dio + dso - dpo;
            const fundingGap = (ar + inventory) - ap;
            
            const formatCurrency = (num) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);

            document.getElementById('calc-dio-result').textContent = `${dio.toFixed(1)}`;
            document.getElementById('calc-dso-result').textContent = `${dso.toFixed(1)}`;
            document.getElementById('calc-dpo-result').textContent = `${dpo.toFixed(1)}`;
            document.getElementById('ccc-calc-string').innerHTML = `
                <span class="text-yellow-600">${dio.toFixed(1)}</span>
                <span class="text-gray-500 text-lg mx-1">+</span>
                <span class="text-blue-600">${dso.toFixed(1)}</span>
                <span class="text-gray-500 text-lg mx-1">-</span>
                <span class="text-green-600">${dpo.toFixed(1)}</span>
                <span class="text-gray-500 text-lg mx-1">=</span>
                <span class="text-red-600 text-2xl font-bold">${ccc.toFixed(1)} Days</span>`;
            
            document.getElementById('calc-funding-gap').textContent = formatCurrency(fundingGap);
        }

        function calculateCurrencyRisk() {
            const amount = parseFloat(document.getElementById('cr-amount').value) || 0;
            const spot = parseFloat(document.getElementById('cr-spot').value) || 0;
            const forward = parseFloat(document.getElementById('cr-forward').value) || 0;
            const futureSpotEl = document.getElementById('cr-future-spot');
            const futureSpot = parseFloat(futureSpotEl.value) || 0;

            const minRate = spot > 0 ? spot - (spot * 0.05) : 0;
            const maxRate = spot > 0 ? spot + (spot * 0.05) : 100;
            futureSpotEl.min = minRate.toFixed(2);
            futureSpotEl.max = maxRate.toFixed(2);
            
            document.getElementById('cr-future-spot-value').textContent = `Simulated Rate: ${futureSpot.toFixed(2)}`;

            const hedgedInr = amount * forward;
            const unhedgedInr = amount * futureSpot;
            const difference = hedgedInr - unhedgedInr;
            
            const formatCurrency = (num) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);

            document.getElementById('cr-hedged-result').textContent = formatCurrency(hedgedInr);
            document.getElementById('cr-unhedged-result').textContent = formatCurrency(unhedgedInr);
            
            const resultEl = document.getElementById('cr-final-result');
            if (difference > 0) {
                resultEl.innerHTML = `${formatCurrency(difference)} <span class="text-sm font-semibold text-green-700">(Gain by Hedging)</span>`;
                resultEl.className = 'text-3xl font-extrabold text-green-600';
            } else if (difference < 0) {
                resultEl.innerHTML = `${formatCurrency(Math.abs(difference))} <span class="text-sm font-semibold text-orange-700">(Opportunity Cost)</span>`;
                resultEl.className = 'text-3xl font-extrabold text-orange-600';
            } else {
                resultEl.innerHTML = `No Difference`;
                resultEl.className = 'text-3xl font-extrabold text-gray-600';
            }
        }

        function calculateFinancingCosts() {
            const amount = parseFloat(document.getElementById('fc-amount').value) || 0;
            const duration = parseFloat(document.getElementById('fc-duration').value) || 0;
            const pcRate = parseFloat(document.getElementById('fc-pc-rate').value) || 0;
            const bdRate = parseFloat(document.getElementById('fc-bd-rate').value) || 0;
            const odRate = parseFloat(document.getElementById('fc-od-rate').value) || 0;
            
            const formatCurrency = (num) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);

            const pcCost = (amount * pcRate * duration) / (100 * 365);
            const bdCost = (amount * bdRate * duration) / (100 * 365);
            const odCost = (amount * odRate * duration) / (100 * 365);

            document.getElementById('fc-pc-result').textContent = formatCurrency(pcCost);
            document.getElementById('fc-bd-result').textContent = formatCurrency(bdCost);
            document.getElementById('fc-od-result').textContent = formatCurrency(odCost);
        }

        function showSection(sectionId) {
            navItems.forEach(item => {
                const section = document.getElementById(item.id);
                if (section) section.classList.add('hidden');
            }); 
            
            const activeSection = document.getElementById(sectionId);
            if (activeSection) activeSection.classList.remove('hidden');
            
            navItems.forEach(item => {
                const dButton = document.getElementById(`nav-d-${item.id}`);
                const mButton = document.getElementById(`nav-m-${item.id}`);
                if (dButton) dButton.classList.remove('active');
                if (mButton) {
                    mButton.classList.remove('active', 'bg-var(--color-primary)', 'text-white');
                    mButton.classList.add('bg-gray-200', 'text-gray-700');
                }
            });

            const activeDButton = document.getElementById(`nav-d-${sectionId}`);
            const activeMButton = document.getElementById(`nav-m-${sectionId}`);
            if(activeDButton) activeDButton.classList.add('active');
            if(activeMButton) {
                activeMButton.classList.remove('bg-gray-200', 'text-gray-700');
                activeMButton.classList.add('active', 'bg-var(--color-primary)', 'text-white');
            }
        }
    </script>
</body>
</html>
